/**
 * Manage System v3.0 | haovei@qq.com
 */
define("datepicker/datepicker",["moment","angular"],function(e){e.defineLocale("zh-cn",{months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"日_一_二_三_四_五_六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),longDateFormat:{LT:"Ah点mm分",LTS:"Ah点m分s秒",L:"YYYY-MM-DD",LL:"YYYY年MMMD日",LLL:"YYYY年MMMD日Ah点mm分",LLLL:"YYYY年MMMD日ddddAh点mm分",l:"YYYY-MM-DD",ll:"YYYY年MMMD日",lll:"YYYY年MMMD日Ah点mm分",llll:"YYYY年MMMD日ddddAh点mm分"},meridiemParse:/凌晨|早上|上午|中午|下午|晚上/,meridiemHour:function(e,t){return 12===e&&(e=0),"凌晨"===t||"早上"===t||"上午"===t?e:"下午"===t||"晚上"===t?e+12:e>=11?e:e+12},meridiem:function(e,t,n){var a=100*e+t;return 600>a?"凌晨":900>a?"早上":1130>a?"上午":1230>a?"中午":1800>a?"下午":"晚上"},calendar:{sameDay:function(){return 0===this.minutes()?"[今天]Ah[点整]":"[今天]LT"},nextDay:function(){return 0===this.minutes()?"[明天]Ah[点整]":"[明天]LT"},lastDay:function(){return 0===this.minutes()?"[昨天]Ah[点整]":"[昨天]LT"},nextWeek:function(){var t,n;return t=e().startOf("week"),n=this.unix()-t.unix()>=604800?"[下]":"[本]",0===this.minutes()?n+"dddAh点整":n+"dddAh点mm"},lastWeek:function(){var t,n;return t=e().startOf("week"),n=this.unix()<t.unix()?"[上]":"[本]",0===this.minutes()?n+"dddAh点整":n+"dddAh点mm"},sameElse:"LL"},ordinalParse:/\d{1,2}(日|月|周)/,ordinal:function(e,t){switch(t){case"d":case"D":case"DDD":return e+"日";case"M":return e+"月";case"w":case"W":return e+"周";default:return e}},relativeTime:{future:"%s内",past:"%s前",s:"几秒",m:"1 分钟",mm:"%d 分钟",h:"1 小时",hh:"%d 小时",d:"1 天",dd:"%d 天",M:"1 个月",MM:"%d 个月",y:"1 年",yy:"%d 年"},week:{dow:1,doy:4}});var t=angular.module("datePicker",[]);t.constant("datePickerConfig",{template:"tpl/datepicker.html",view:"month",views:["year","month","date","hours","minutes"],momentNames:{year:"year",month:"month",date:"day",hours:"hours",minutes:"minutes"},viewConfig:{year:["years","isSameYear"],month:["months","isSameMonth"],hours:["hours","isSameHour"],minutes:["minutes","isSameMinutes"]},step:5}),t.filter("mFormat",function(){return function(t,n,a){return e.isMoment(t)?a?e.tz(t,a).format(n):t.format(n):e(t).format(n)}}),t.directive("datePicker",["datePickerConfig","datePickerUtils",function(t,n){return{require:"?ngModel",template:'<div ng-include="template"></div>',scope:{model:"=datePicker",after:"=?",before:"=?",dateSelect:"=?",dateMonth:"=?",statusList:"=?"},link:function(a,i,o,r){function l(){a.views=t.views.concat(),a.view=o.view||t.view,a.views=a.views.slice(a.views.indexOf(o.maxView||"year"),a.views.indexOf(o.minView||"minutes")+1),1!==a.views.length&&-1!==a.views.indexOf(a.view)||(a.view=a.views[0])}function s(e){return n.getDate(a,o,e)}function c(e){e&&(a.model=e,r&&r.$setViewValue(e.format(o.format))),a.$emit("setDate",a.model,a.view),a.callbackOnSetDate&&a.callbackOnSetDate(o.datePicker,a.date)}function u(){var e=a.view;n.setParams(y),a.model&&!v&&(a.date=b(a.model),v=!1);var t=a.date;switch(e){case"year":a.years=n.getVisibleYears(t);break;case"month":a.months=n.getVisibleMonths(t);break;case"date":a.weekdays=a.weekdays||n.getDaysOfWeek(),a.weeks=n.getVisibleWeeks(t);break;case"hours":a.hours=n.getVisibleHours(t);break;case"minutes":a.minutes=n.getVisibleMinutes(t,D)}p()}function d(){return"date"!==a.view?a.view:a.date?a.date.month():null}function p(){var e,i,o=a.view,r=a.date,l=[],s="";if(n.setParams(y),"date"===o){var c,u=a.weeks;for(e=0;e<u.length;e++)for(c=u[e],l.push([]),i=0;i<c.length;i++)s="",n.isSameDay(r,c[i])&&(s+="active"),h(c[i],o)&&(s+=" now"),c[i].month()===r.month()&&g(c[i])||(s+=" disabled"),l[e].push(s)}else{var d=t.viewConfig[o],p=a[d[0]],f=d[1];for(e=0;e<p.length;e++)s="",n[f](r,p[e])&&(s+="active"),h(p[e],o)&&(s+=" now"),g(p[e])||(s+=" disabled"),l.push(s)}a.classes=l}function g(e){var t=!0;return w&&w.isAfter(e)&&(t=f(w,e)),C&&C.isBefore(e)&&(t&=f(C,e)),t}function f(e,n){return!!e.isSame(n,t.momentNames[a.view])}function m(e){return w&&w.isAfter(e)?w:C&&C.isBefore(e)?C:e}function h(e,t){var n=!0;switch(t){case"minutes":n&=~~(S.minutes()/D)===~~(e.minutes()/D);case"hours":n&=S.hours()===e.hours();case"date":n&=S.date()===e.date();case"month":n&=S.month()===e.month();case"year":n&=S.year()===e.year()}return n}n.setParams(o.timezone);var v=!1,y=a.tz=o.timezone,b=n.createMoment,$=n.eventIsForPicker,D=parseInt(o.step||t.step,10),k=!!o.partial,w=s("minDate"),C=s("maxDate"),x=i[0].id,S=a.now=b(),L=a.date=b(a.model||S),A="true"===o.autoClose;a.model||L.minute(Math.ceil(L.minute()/D)*D).second(0),a.template=o.template||t.template,a.watchDirectChanges=void 0!==o.watchDirectChanges,a.callbackOnSetDate=o.dateChange?n.findFunction(a,o.dateChange):void 0,l(),a.setView=function(e){-1!==a.views.indexOf(e)&&(a.view=e)},a.selectDate=function(e){if(o.disabled)return!1;if(f(a.date,e)&&(e=a.date),"date"==a.view&&a.dateSelect&&a.dateSelect(e),e=m(e),!e)return!1;a.date=e;var t=a.views[a.views.indexOf(a.view)+1];(!t||k||a.model)&&c(e),t?a.setView(t):A?(i.addClass("hidden"),a.$emit("hidePicker")):p()},a.$watch(d,u),a.watchDirectChanges&&a.$watch("model",function(){v=!1,u()}),a.next=function(t){var n=e(a.date);switch(t=t||1,a.view){case"year":case"month":n.year(n.year()+t);break;case"date":n.month(n.month()+t),a.dateMonth&&a.dateMonth(n);break;case"hours":case"minutes":n.hours(n.hours()+t)}n=m(n),n&&(a.date=n,c(n),v=!0,u())},a.prev=function(e){return a.next(-e||-1)},x&&a.$on("pickerUpdate",function(e,t,n){if($(t,x)){var a=!1,i=!1;angular.isDefined(n.minDate)&&(w=n.minDate?n.minDate:!1,i=!0),angular.isDefined(n.maxDate)&&(C=n.maxDate?n.maxDate:!1,i=!0),angular.isDefined(n.minView)&&(o.minView=n.minView,a=!0),angular.isDefined(n.maxView)&&(o.maxView=n.maxView,a=!0),o.view=n.view||o.view,a&&l(),i&&u()}})}}}]),angular.module("datePicker").factory("datePickerUtils",function(){var t,n=function(n,a,i,o,r){var l=Date.UTC(0|n,0|a,0|i,0|o,0|r);return t?e.tz(l,t):e(l)};return{getVisibleMinutes:function(e,t){var a,i,o=e.year(),r=e.month(),l=e.date(),s=e.hours(),c=e.utcOffset()/60,u=[];for(i=0;60>i;i+=t)a=n(o,r,l,s-c,i),u.push(a);return u},getVisibleWeeks:function(t){t=e(t);var n=t.year(),a=t.month();t.date(1);var i=t.day();0===i?t.date(-6):t.date(1-i);for(var o=[];o.length<6&&!(t.year()===n&&t.month()>a);)o.push(this.getDaysOfWeek(t)),t.add(7,"d");return o},getVisibleYears:function(t){var a=e(t),i=a.year();a.year(i-i%10),i=a.year();for(var o,r,l=a.utcOffset()/60,s=[],c=0;12>c;c++)o=n(i,0,1,0-l),r=o.utcOffset()/60,r!==l&&(o=n(i,0,1,0-r),l=r),s.push(o),i++;return s},getDaysOfWeek:function(a){a=a?a:t?e.tz(t).day(0):e().day(0);for(var i,o,r=a.year(),l=a.month(),s=a.date(),c=[],u=a.utcOffset()/60,d=0;7>d;d++)i=n(r,l,s,0-u,0,!1),o=i.utcOffset()/60,o!==u&&(i=n(r,l,s,0-o,0,!1)),c.push(i),s++;return c},getVisibleMonths:function(e){for(var t,a,i=e.year(),o=e.utcOffset()/60,r=[],l=0;12>l;l++)t=n(i,l,1,0-o,0,!1),a=t.utcOffset()/60,a!==o&&(t=n(i,l,1,0-a,0,!1)),r.push(t);return r},getVisibleHours:function(e){var t,a,i,o=e.year(),r=e.month(),l=e.date(),s=[],c=e.utcOffset()/60;for(t=0;24>t;t++)a=n(o,r,l,t-c,0,!1),i=a.utcOffset()/60,i!==c&&(a=n(o,r,l,t-i,0,!1)),s.push(a);return s},isAfter:function(e,t){return e&&e.unix()>=t.unix()},isBefore:function(e,t){return e.unix()<=t.unix()},isSameYear:function(e,t){return e&&e.year()===t.year()},isSameMonth:function(e,t){return this.isSameYear(e,t)&&e.month()===t.month()},isSameDay:function(e,t){return this.isSameMonth(e,t)&&e.date()===t.date()},isSameHour:function(e,t){return this.isSameDay(e,t)&&e.hours()===t.hours()},isSameMinutes:function(e,t){return this.isSameHour(e,t)&&e.minutes()===t.minutes()},setParams:function(e){t=e},findFunction:function(e,t){var n=e;do if(n=n.$parent,angular.isFunction(n[t]))return n[t];while(n.$parent);return!1},findParam:function(e,t){var n=e;do if(n=n.$parent,n[t])return n[t];while(n.$parent);return!1},createMoment:function(n){return t?e.tz(n,t):e.isMoment(n)?e.unix(n.unix()):e(n)},getDate:function(e,t,n){var a=!1;return t[n]&&(a=this.createMoment(t[n]),a.isValid()||(a=this.findParam(e,t[n]),a&&(a=this.createMoment(a)))),a},eventIsForPicker:function(e,t){return angular.isArray(e)&&e.indexOf(t)>-1||e===t}}});var t=angular.module("datePicker");t.directive("dateRange",["$compile","datePickerUtils","dateTimeConfig",function(t,n,a){function i(t,n,i,o,r){return a.template(angular.extend(t,{ngModel:i,minDate:o&&e.isMoment(o)?o.format():!1,maxDate:r&&e.isMoment(r)?r.format():!1}),n)}function o(){return"picker"+Math.random().toString().substr(2)}return{scope:{start:"=",end:"="},link:function(e,a,r){function l(t){e.$broadcast("pickerUpdate",d[0],{maxDate:t})}function s(t){e.$broadcast("pickerUpdate",d[1],{minDate:t})}var c=null,u=a[0].id,d=[o(),o()],p=n.createMoment,g=n.eventIsForPicker;e.dateChange=function(e,t){c&&c(e,t)},u&&e.$on("pickerUpdate",function(t,n,a){g(n,u)&&e.$broadcast("pickerUpdate",d,a)}),n.setParams(r.timezone),e.start=p(e.start),e.end=p(e.end),e.$watchGroup(["start","end"],function(e){s(e[0]),l(e[1])}),angular.isDefined(r.dateChange)&&(c=n.findFunction(e,r.dateChange)),r.onSetDate="dateChange";var f='<div><table class="date-range"><tr><td valign="top">'+i(r,d[0],"start",!1,e.end)+'</td><td valign="top">'+i(r,d[1],"end",e.start,!1)+"</td></tr></table></div>",m=t(f)(e);a.append(m)}}}]);var n="ng-pristine",a="ng-dirty",t=angular.module("datePicker");t.constant("dateTimeConfig",{template:function(e,t){return"<div "+(t?'id="'+t+'" ':"")+'date-picker="'+e.ngModel+'" '+(e.view?'view="'+e.view+'" ':"")+(e.format?'format="'+e.format+'" ':"")+(e.maxView?'max-view="'+e.maxView+'" ':"")+(e.maxDate?'max-date="'+e.maxDate+'" ':"")+(e.autoClose?'auto-close="'+e.autoClose+'" ':"")+(e.template?'template="'+e.template+'" ':"")+(e.minView?'min-view="'+e.minView+'" ':"")+(e.minDate?'min-date="'+e.minDate+'" ':"")+(e.partial?'partial="'+e.partial+'" ':"")+(e.step?'step="'+e.step+'" ':"")+(e.onSetDate?'date-change="'+e.onSetDate+'" ':"")+(e.ngModel?'ng-model="'+e.ngModel+'" ':"")+(e.timezone?'timezone="'+e.timezone+'" ':"")+'class="date-picker-date-time"></div>'},format:"YYYY-MM-DD HH:mm",views:["date","year","month","hours","minutes"],autoClose:!1,position:"relative"}),t.directive("dateTimeAppend",function(){return{link:function(e,t){t.bind("click",function(){t.find("input")[0].focus()})}}}),t.directive("dateTime",["$compile","$document","$filter","dateTimeConfig","$parse","datePickerUtils","$timeout",function(t,i,o,r,l,s,c){var u=i.find("body"),d=o("mFormat");return{require:"ngModel",scope:!0,link:function(i,o,c,p){function g(e){var t=d(e,k,F);return e||(p.$setViewValue(t),o.val(t)),t}function f(e){return e.length===k.length?e:void 0}function m(t){E=t,c.minDate=t?t.format():t,j=e.isMoment(t)}function h(t){B=t,c.maxDate=t?t.format():t,V=e.isMoment(t)}function v(){D=r.template(c)}function y(e){e.stopPropagation(),p.$pristine&&(p.$dirty=!0,p.$pristine=!1,o.removeClass(n).addClass(a),w&&w.$setDirty(),p.$render())}function b(){A&&(A.remove(),A=null),T&&(T.remove(),T=null)}function $(){if(!A){if(A=t(D)(i),i.$digest(),Y||(i.$on("setDate",function(e,t,n){y(e),q&&q(c.ngModel,t),L&&C[C.length-1]===n&&b()}),i.$on("hidePicker",function(){o.triggerHandler("blur")}),i.$on("$destroy",b),Y=!0),"absolute"===M){var e=angular.extend(o.offset(),{height:o[0].offsetHeight});A.css({top:e.top+e.height,left:e.left,display:"block",position:M}),u.append(A)}else T=angular.element("<div date-picker-wrapper></div>"),o[0].parentElement.insertBefore(T[0],o[0]),T.append(A),A.css({top:o[0].offsetHeight+"px",display:"block"});A.bind("mousedown",function(e){e.preventDefault()})}}var D,k=c.format||r.format,w=o.inheritedData("$formController"),C=l(c.views)(i)||r.views.concat(),x=c.view||C[0],S=C.indexOf(x),L=c.autoClose?l(c.autoClose)(i):r.autoClose,A=null,P=o[0].id,M=c.position||r.position,T=null,E=null,j=null,B=null,V=null,F=c.timezone||!1,O=s.eventIsForPicker,q=null,Y=!1;-1===S&&C.splice(S,1),C.unshift(x),p.$formatters.push(g),p.$parsers.unshift(f),angular.isDefined(c.minDate)&&(m(s.findParam(i,c.minDate)),p.$validators.min=function(t){return j?e.isMoment(t)&&(E.isSame(t)||E.isBefore(t)):!0}),angular.isDefined(c.maxDate)&&(h(s.findParam(i,c.maxDate)),p.$validators.max=function(t){return V?e.isMoment(t)&&(B.isSame(t)||B.isAfter(t)):!0}),angular.isDefined(c.dateChange)&&(q=s.findFunction(i,c.dateChange)),P&&i.$on("pickerUpdate",function(e,t,n){if(O(t,P))if(A);else{var a=!1;angular.isDefined(n.minDate)&&(m(n.minDate),a=!0),angular.isDefined(n.maxDate)&&(h(n.maxDate),a=!0),angular.isDefined(n.minView)&&(c.minView=n.minView),angular.isDefined(n.maxView)&&(c.maxView=n.maxView),c.view=n.view||c.view,a&&p.$validate(),angular.isDefined(n.format)&&(k=c.format=n.format||r.format,p.$modelValue=-1),v()}}),o.bind("focus",$),o.bind("blur",b),v()}}}])}),define("main/controllers",["main/init"],function(){function e(e){e.mainStatus={navFold:document.body.clientWidth<1500,navigation:"",msgBubble:0},e.mainConfig=window.Config||{},e.pageTo=function(e){window.location.assign(e)},e.mainConfig.getMainInfo&&$.getJSON(e.mainConfig.getMainInfo,function(t){200==t.code&&angular.extend(e.mainStatus,t.data)}).complete(function(){e.$digest()}),$(document).on("click",".top-nav-wrap .backBtn",function(){window.history.back()})}function t(){}function n(e){}function a(e,t){t.closeAll()}e.$inject=["$scope"],n.$inject=["$scope"],a.$inject=["$scope","modal"],angular.module("manageApp.main").controller("mainCtrl",e).controller("oneCtrl",t).controller("sideNav",n).controller("pageCtrl",a)}),define("main/directives",["main/init"],function(){function ngView(e,t,n){return{restrict:"A",priority:-500,link:function(a,i){t.remove(e.current.loadedTemplateUrl),a.mainStatus.pageParams=n}}}function convertToDate(e){var t=e("date");return{require:"ngModel",link:function(e,n,a,i){var o=a.convertToDate?a.convertToDate:"yyyy-MM-dd";i.$parsers.push(function(e){return t(e,o)}),i.$formatters.push(function(){return new Date(i.$modelValue)})}}}function convertToNumber(){return{require:"ngModel",link:function(e,t,n,a){a.$parsers.push(function(e){return parseInt(e,10)}),a.$formatters.push(function(e){return""+e})}}}function detailsInfo(e){return{restrict:"AE",scope:!0,transclude:!0,link:function(t,n,a,i,o){function r(n){t.isLoading=!0,e(a.detailsInfo,n).then(function(e){var n=e[0];t.detailsResponse=e[1],t.isLoading=!1,t.detailsHandler?t.details=t.detailsHandler(n):t.details=n,t.listCallback&&t.listCallback(e[1])})["catch"](function(){t.details={},t.isLoading=!1})}t.isLoading=!1,o(t,function(e){n.append(e)}),t.detailsHandler=t.$eval(a.detailsHandler),a.detailsParams?0==a.detailsParams.indexOf("{")?a.$observe("detailsParams",function(e){r(t.$eval(e))}):t.$watch(a.detailsParams,function(e){r(e)},!0):a.$observe("detailsInfo",function(e){r({})}),t.$on("reloadDetails",function(){r({})})}}}function formValidator(e,t,n){return{restrict:"A",scope:!0,link:function(n,a,i){var o=n.formStatus={submitted:!1,submitting:!1,submitInfo:""},r=angular.element(a)[0],l=(n.$eval(i.name),n.ngDialogData);n.formData=angular.extend({},n.formData),n.$watch(i.source,function(e){e&&angular.isObject(e)&&angular.extend(n.formData,e)}),n.reset=function(){r.reset()},a.on("submit",function(a){a.preventDefault(),o.submitting=!0,e(i.action,n.formData).then(function(e){var a=e[0];o.submitting=!1,o.submitInfo="",angular.isFunction(n.submitCallBack)?n.submitCallBack.call(n,l,a):a&&a.url&&window.location.assign(a.url),angular.isDefined(i.autoCloseDialog)&&t.close()})["catch"](function(e){o.submitting=!1,o.submitInfo=e||"提交失败。",angular.isFunction(n.submitCallBack)&&n.submitCallBack.call(n,l,"")})})}}}function tableList(e,t,n,a){return{restrict:"AE",scope:{listParams:"=?",listSelected:"=?",listSource:"=?"},transclude:!0,require:"?^ngModel",link:function(i,o,r,l,s){function c(t){return r.listSource?void(i.listSource&&(i.tbodyList=angular.isArray(i.listSource)?i.listSource:i.listSource.list,i.listSource.options&&(p.totalCount=i.listSource.options.totalCount||p.totalCount,p.pageSize=i.listSource.options.pageSize||p.pageSize,p.totalPage=Math.ceil(p.totalCount/p.pageSize)),t&&t())):void(p.isLoading||(p.isLoading=!0,e(r.listData,angular.merge({},g,{page:p.currentPage})).then(function(e){var n=e[1];200==n.code?(n.options&&(p.totalCount=n.options.totalCount||p.totalCount,p.pageSize=n.options.pageSize||p.pageSize,p.totalPage=Math.ceil(p.totalCount/p.pageSize)),n.thead&&(i.theadList=n.thead),n.data&&n.data.length>0?i.tbodyList=n.data:p.isFinished=!0,p.loadFailMsg=n.message):(p.isFinished=!0,p.loadFailMsg=n.message),p.isLoading=!1,a(d),t&&t()})["catch"](function(){p.isLoading=!1,p.loadFailMsg="加载出错",t&&t()})))}function u(){var e=[];i.listSelected.length=0,$(".selectOne:checked",o).each(function(){e.push(this.value)}),[].unshift.apply(i.listSelected,e);var t=[];angular.forEach(i.tbodyList,function(e){angular.forEach(i.listSelected,function(n){e.id==n&&t.push(e)})}),l&&l.$setViewValue(t)}function d(){$(".selectOne",o).on("click",function(e){e.stopPropagation();var t=$(".selectOne",o).length,n=$(".selectOne:checked",o).length;n>0&&t>n?$(".selectAll",o).prop("checked",!1).get(0).indeterminate=!0:t==n?$(".selectAll",o).prop("checked",!0).get(0).indeterminate=!1:$(".selectAll",o).prop("checked",!1).get(0).indeterminate=!1,u(),i.$apply()})}var p={currentPage:1,totalCount:0,pageSize:10,totalPage:1,isFinished:!1,isLoading:!1};i.mainStatus=i.$parent.mainStatus,i.parent=i.$parent,i.status=p,i.listData=r.listData,i.theadList=angular.fromJson(r.listThead),i.tbodyList=[],i.getListData=c,angular.isDefined(i.listParams)||(i.listParams={}),angular.isDefined(i.listSelected)||(i.listSelected=[]),i.delSelected=function(t){n("确定删除这些?",function(){e(t,{ids:i.listSelected.join(",")}).then(function(){i.$broadcast("reloadList")})["catch"](function(e){alert(e||"删除错误")})})},i.deleteThis=function(t){var a=this.tr;n("确定删除?",function(){e(t,{id:a.id}).then(function(){i.tbodyList.splice(i.tbodyList.indexOf(a),1),0==i.tbodyList.length&&i.$broadcast("reloadList")})["catch"](function(e){alert(e||"删除错误")})})},i.selectThis=function(){var e=this.tr,t=i.tbodyList.indexOf(e),n=o.find("tbody tr");n.removeClass("on").eq(t).addClass("on"),l&&l.$setViewValue(angular.copy(e))},i.changeStatus=function(t,a){var o=this.tr;n(a||"确定?",function(){e(t,{id:o.id}).then(function(e){var t=e[0],n=i.tbodyList.indexOf(o);i.tbodyList[n]=t})["catch"](function(e){alert(e||"请求失败!")})})},i.submitCallBack=function(e,n){t.closeAll(),n&&e?angular.forEach(i.tbodyList,function(t,a){t.id==e.id&&(i.tbodyList[a]=n)}):a(function(){i.$broadcast("reloadList")})};var g={};i.$on("deleteSelected",function(e,t){$(".selectOne[value="+t.id+"]",o).prop("checked",!1);var n=$(".selectOne",o).length,a=$(".selectOne:checked",o).length;a>0&&n>a?$(".selectAll",o).prop("checked",!1).get(0).indeterminate=!0:n==a?$(".selectAll",o).prop("checked",!0).get(0).indeterminate=!1:$(".selectAll",o).prop("checked",!1).get(0).indeterminate=!1;var r=[];i.listSelected.length=0,$(".selectOne:checked",o).each(function(){r.push(this.value)}),[].unshift.apply(i.listSelected,r),u()}),i.$watchCollection("listSource",function(e){e&&c(u)}),i.$watch("listParams",function(){p.currentPage=1,p.isFinished=!1,i.tbodyList=[],g=angular.copy(i.listParams),c(u),$(".selectAll",o).length>0&&($(".selectAll",o).prop("checked",!1).get(0).indeterminate=!1)},!0),r.$observe("listData",function(e){p.currentPage=1,p.isFinished=!1,i.tbodyList=[],g=angular.copy(i.listParams),c(u),$(".selectAll",o).length>0&&($(".selectAll",o).prop("checked",!1).get(0).indeterminate=!1)}),i.$on("reloadList",function(){p.currentPage=1,p.isFinished=!1,i.tbodyList=[],g=angular.copy(i.listParams),c(u),$(".selectAll",o).length>0&&($(".selectAll",o).prop("checked",!1).get(0).indeterminate=!1)}),$(o).on("click",".selectAll",function(){this.indeterminate?(this.checked=!1,$(".selectOne",o).prop("checked",!1)):$(".selectOne",o).prop("checked",this.checked),u(),i.$apply()}),s(i,function(e){o.append(e)})}}}function tableCell(){return{restrict:"AE",scope:{row:"="},replace:!0,templateUrl:"tpl/table-cell.html",link:function(e,t,n){e.cells=[],angular.isString(e.row)||angular.isNumber(e.row)?e.cells.push({text:e.row}):angular.isArray(e.row)?angular.forEach(e.row,function(t){angular.isObject(t)?e.cells.push(t):e.cells.push({text:t})}):e.cells.push(e.row)}}}function pagination(){return{restrict:"AE",scope:!0,replace:!0,templateUrl:"tpl/pagination.html",link:function(e,t,n){function a(e,t,n){return{number:e,text:t,active:n}}function i(e,t){var n=[],i=1,l=t,s=angular.isDefined(o)&&t>o;s&&(r?(i=Math.max(e-Math.floor(o/2),1),l=i+o-1,l>t&&(l=t,i=l-o+1)):(i=(Math.ceil(e/o)-1)*o+1,l=Math.min(i+o-1,t)));for(var c=i;l>=c;c++){var u=a(c,c,c===e);n.push(u)}if(s&&!r){if(i>1){var d=a(i-1,"...",!1);n.unshift(d)}if(t>l){var p=a(l+1,"...",!1);n.push(p)}}return n}var o=angular.isDefined(n.maxSize)?e.$parent.$eval(n.maxSize):10,r=angular.isDefined(n.rotate)?e.$parent.$eval(n.rotate):!0;e.start=function(){1!=e.status.currentPage&&(e.status.currentPage=1,e.getListData())},e.prev=function(){e.status.currentPage<=1||(e.status.currentPage--,e.getListData())},e.next=function(){e.status.currentPage>=e.status.totalPage||(e.status.currentPage++,e.getListData())},e.end=function(){e.status.currentPage!=e.status.totalPage&&(e.status.currentPage=e.status.totalPage,e.getListData())},e["goto"]=function(t){e.status.currentPage=t,e.getListData()},e.$watch("status.totalPage",function(){e.pages=i(e.status.currentPage,e.status.totalPage)}),e.$watch("status.currentPage",function(){e.pages=i(e.status.currentPage,e.status.totalPage)})}}}function pagination2(){return{restrict:"AE",scope:!0,replace:!0,templateUrl:"tpl/pagination2.html",link:function(e,t,n){e.start=function(){1!=e.status.currentPage&&(e.status.currentPage=1,e.getListData())},e.prev=function(){e.status.currentPage<=1||(e.status.currentPage--,e.getListData())},e.next=function(){e.status.currentPage>=e.status.totalPage||(e.status.currentPage++,e.getListData())},e.end=function(){e.status.currentPage!=e.status.totalPage&&(e.status.currentPage=e.status.totalPage,e.getListData())}}}}function filterConditions(e){return{restrict:"AE",scope:{},transclude:!0,link:function(t,n,a,i,o){function r(){var e={};angular.forEach(t.filterConditions.list,function(t){e[t.type]=t.id}),t.filterParams=e}t.filterParams={},t.filterConditions={list:[]};var l=t.filterConditions;t.conditionList={},t.selectCondition=function(e,t){t.type=e,l[e]=t,l.list.push(t),r()},t.deleteCondition=function(e){var t=l.list.indexOf(e);l.list.splice(t,1),delete l[e.type],r()},a.filterConditions&&!function(){e(a.filterConditions).then(function(e){var n=e[0];t.conditionList=n})}(),o(t,function(e){n.append(e)})}}}function treeList(e,t){return{restrict:"AE",scope:{},require:"?^ngModel",templateUrl:"tpl/tree.html",link:function(n,a,i,o){function r(e){for(var t={},n=[],a=0;0!=e.length;){if("0"==e[a].pid){var i=angular.copy(e[a]);i.nodes=[],n.push(i),t[e[a].id]=[n.length-1],e.splice(a,1),a--}else{var o=t[e[a].pid];if(void 0!=o){for(var r=n[o[0]],l=1;l<o.length;l++)r=r.nodes[o[l]];var i=angular.copy(e[a]);i.nodes=[],r.nodes.push(i),t[e[a].id]=o.concat([r.nodes.length-1]),e.splice(a,1),a--}}a++,a>e.length-1&&(a=0)}return n}function l(){n.status.isLoading=!0,e(i.treeList).then(function(e){var o=e[0];n.treeList=r(o),n.status.isLoading=!1,s&&angular.isDefined(i.selectFirst)&&(s=!1,t(function(){for(var e=a.find("em"),t=0,n=e.length;n>t&&(e.eq(t).trigger("click"),0!=e.eq(t).next("ul").length);t++);}))})["catch"](function(){n.status.isLoading=!1})}var s=!0;n.status={},n.treeList=[],n.curTree={},n.status.isLoading=!0,n.selectTree=function(e,t){var n=a.find("li"),i=$(t.currentTarget),r=i.parent("li"),l=angular.copy(e);0==l.nodes.length?(n.removeClass("on"),r.addClass("on"),o&&o.$setViewValue(l)):r.hasClass("fold")?r.removeClass("fold"):r.addClass("fold")},i.$observe("treeList",l)}}}function treeList2(e,t,n,a){return{restrict:"AE",require:"?^ngModel",link:function(i,o,r,l){function s(e){for(var t={},n=[],a=0;0!=e.length;){if("0"==e[a].pid){var i=angular.copy(e[a]);i.nodes=[],n.push(i),t[e[a].id]=[n.length-1],e.splice(a,1),a--}else{var o=t[e[a].pid];if(void 0!=o){for(var r=n[o[0]],l=1;l<o.length;l++)r=r.nodes[o[l]];var i=angular.copy(e[a]);i.nodes=[],r.nodes.push(i),t[e[a].id]=o.concat([r.nodes.length-1]),e.splice(a,1),a--}}a++,a>e.length-1&&(a=0)}return n}function c(){i.status.isLoading=!0,e(r.treeList2).then(function(e){var t=e[0];i.treeList=s(t),i.status.isLoading=!1})["catch"](function(){i.status.isLoading=!1})}var u=angular.isDefined(r.selectGroup);i.status={},i.treeList=[],i.curTree={},i.status.isLoading=!0,i.selectTree=function(e,t){var n=o.find("li"),a=$(t.currentTarget),i=a.parent("li"),r=angular.copy(e);0==r.nodes.length||u?(n.removeClass("on"),i.addClass("on"),delete r.nodes,l&&l.$setViewValue(r)):i.hasClass("fold")?i.removeClass("fold"):i.addClass("fold")},i.extendTree=function(e){e.preventDefault(),e.stopPropagation();var t=$(e.currentTarget),n=t.parent().parent("li");n.hasClass("fold")?(n.removeClass("fold"),t.parent().next().hide()):(n.addClass("fold"),t.parent().next().show())},i.deleteTree=function(t,n){t.preventDefault(),t.stopPropagation(),a("是否删除?",function(){e(n).then(function(){c()})})},i.addTree=function(e,n){e.preventDefault(),e.stopPropagation(),t.closeAll(),t.open({template:n,className:"ngdialog-theme-right",cache:!1,trapFocus:!0,overlay:!1,scope:i,controller:["$scope","$element",function(e,t){$(".ngdialog-content",t).width(400)}]})},r.$observe("treeList2",c),i.submitCallBack=function(e,a){t.closeAll(),n(function(){c()})}}}}function navList(e){return{restrict:"AE",scope:!0,transclude:!0,require:"?^ngModel",link:function(t,n,a,i,o){function r(n){return a.listSource?(t.tbodyList=t.listSource,void(n&&n())):(l.isLoading=!0,void e(a.navList).then(function(e){var n=e[0];t.isLoading=!1,t.listData=n.data,t.select(t.listData[0])})["catch"](function(){t.isLoading=!1}))}o(t,function(e){n.append(e)});var l={isLoading:!0};t.status=l,t.currentSelect={};t.select=function(e){t.currentSelect=e,i&&i.$setViewValue(e)},r()}}}function selectAsync(e){return{restrict:"A",scope:{},require:"?^ngModel",link:function(t,n,a,i){e(a.selectAsync).then(function(e){for(var t=e[0],a='<option value="">请选择</option>',o=t.length,r=0;o>r;r++)a+='<option value="'+t[r].value+'">'+t[r].text+"</option>";n.html(a),i&&n.val(i.$viewValue)})}}}function relativeSelect(e,t){return{restrict:"A",scope:{},require:"?^ngModel",link:function(n,a,i,o){function r(){var e={};e[a[0].name]=a.val(),$(s).trigger("update",e)}function l(t){e(c,t).then(function(e){for(var t=e[0],n=u?"":'<option value="">请选择</option>',i=t.length,l="",s=0;i>s;s++)(t[s].selected||u&&0==s)&&(l=t[s].value),n+="<option "+(0===t[s].enabled?' class="text-muted"':"")+' value="'+t[s].value+'">'+t[s].text+"</option>";a.html(n),a.val(l),o&&o.$setViewValue(l),r()})}var s=i.relativeTo,c=i.relativeSelect,u=angular.isDefined(i.selectFirst),d=angular.isDefined(i.relativeInitload);a.on("change",r),a.on("update",function(e,t){l(t)}),d&&t(r)}}}function eChart(requestData,dialogChart){return{restrict:"A",scope:{clickToUrl:"@",clickToDialog:"@",chartParams:"="},require:"?^ngModel",link:function($scope,$element,$attrs,ngModel){$scope.isLoading=!1,require(["echarts"],function(echarts){function reSize(){myChart.resize()}function loadChart(_url,_params){$scope.isLoading||($scope.isLoading=!0,myChart.showLoading(),requestData(_url,_params).then(function(results){var _data=results[0];myChart.hideLoading(),_data.polar?_data.tooltip.formatter=function(e){var t=e[0].name;return angular.forEach(e,function(e){t+="<br>"+e.seriesName+": "+e.data}),t}:_data.tooltip.formatter&&0==_data.tooltip.formatter.indexOf("function")&&(_data.tooltip.formatter=eval("("+_data.tooltip.formatter+")")),myChart.setOption(_data),$scope.isLoading=!1})["catch"](function(e){$scope.isLoading=!1,myChart.hideLoading()}))}var myChart=echarts.init($element[0]);$(window).on("resize",reSize),$scope.$on("$destroy",function(){$(window).off("resize",reSize),myChart.dispose()}),myChart.on("click",function(e){ngModel&&ngModel.$setViewValue(e.data),$scope.clickToUrl?window.location.assign($scope.clickToUrl):$scope.clickToDialog&&dialogChart($scope.$parent.mainConfig.viewsDir+$scope.clickToDialog)}),angular.isDefined($attrs.chartParams)?$scope.$watch("chartParams",function(e){loadChart($attrs.chart,e)},!0):$attrs.$observe("chart",function(e){loadChart($attrs.chart)}),loadChart($attrs.chart,$scope.chartParams)})}}}function angucomplete(e,t,n,a){return{restrict:"EA",scope:{placeholder:"@",selectedItem:"=?",url:"@",titleField:"@",descriptionField:"@",searchFields:"@",matchClass:"@",ngDisabled:"=?"},require:"?^ngModel",templateUrl:"tpl/autocomplete.html",link:function(e,i,o,r){e.lastSearchTerm=null,e.currentIndex=null,e.justChanged=!1,e.searchTimer=null,e.hideTimer=null,e.searching=!1,e.pause=300,e.minLength=1,e.searchStr=null;var l=function(t,n){return t.length>=e.minLength&&t!=n};e.processResults=function(t,a){if(t&&t.length>0){e.results=[];var i=[];e.titleField&&""!=e.titleField&&(i=e.titleField.split(","));for(var o=0;o<t.length;o++){for(var r=[],l=0;l<i.length;l++)r.push(t[o][i[l]]);var s="";e.descriptionField&&(s=t[o][e.descriptionField]);var c=r.join(" ");if(e.matchClass){var u=new RegExp(a,"i"),d=c.match(u)[0];c=n.trustAsHtml(c.replace(u,'<span class="'+e.matchClass+'">'+d+"</span>"))}var p={id:t[o].id,title:c,description:s,originalObject:t[o]};e.results[e.results.length]=p}}else e.results=[]},e.searchTimerComplete=function(n){if(n.length>=e.minLength)if(e.localData){for(var a=e.searchFields.split(","),i=[],o=0;o<e.localData.length;o++){for(var r=!1,l=0;l<a.length;l++)r=r||"string"==typeof e.localData[o][a[l]]&&"string"==typeof n&&e.localData[o][a[l]].toLowerCase().indexOf(n.toLowerCase())>=0;r&&(i[i.length]=e.localData[o])}e.searching=!1,e.processResults(i,n)}else t(e.url,{q:n}).then(function(t){var a=t[0];e.searching=!1,e.processResults(a,n)})["catch"](function(t){e.searching=!1,console.error(t)})},e.hideResults=function(){e.hideTimer=a(function(){e.showDropdown=!1},e.pause)},e.resetHideResults=function(){e.hideTimer&&a.cancel(e.hideTimer)},e.hoverRow=function(t){e.currentIndex=t},e.keyPressed=function(t){38!=t.which&&40!=t.which&&13!=t.which?e.searchStr&&""!=e.searchStr?l(e.searchStr,e.lastSearchTerm)&&(e.lastSearchTerm=e.searchStr,e.showDropdown=!0,e.currentIndex=-1,e.results=[],e.searchTimer&&a.cancel(e.searchTimer),e.searching=!0,e.searchTimer=a(function(){e.searchTimerComplete(e.searchStr)},e.pause)):(e.showDropdown=!1,e.lastSearchTerm=null):t.preventDefault()},e.selectResult=function(t){e.matchClass&&(t.title=t.title.toString().replace(/(<([^>]+)>)/gi,"")),e.searchStr=e.lastSearchTerm=t.title,e.selectedItem=t,e.showDropdown=!1,e.results=[],r&&r.$setViewValue(t.id)};var s=i.find("input");s.on("keyup",e.keyPressed),i.on("keyup",function(t){40===t.which?(e.results&&e.currentIndex+1<e.results.length&&(e.currentIndex++,e.$apply(),t.preventDefault,t.stopPropagation()),e.$apply()):38==t.which?e.currentIndex>=1&&(e.currentIndex--,e.$apply(),t.preventDefault,t.stopPropagation()):13==t.which?e.results&&e.currentIndex>=0&&e.currentIndex<e.results.length?(e.selectResult(e.results[e.currentIndex]),e.$apply(),t.preventDefault,t.stopPropagation()):(e.results=[],e.$apply(),t.preventDefault,t.stopPropagation()):27==t.which?(e.results=[],e.showDropdown=!1,e.$apply()):8==t.which&&(e.selectedItem=null,e.$apply())})}}}function checkboxGroup(){return{restrict:"A",scope:{checkboxGroup:"="},link:function(e,t,n){angular.isArray(e.checkboxGroup)||(e.checkboxGroup=[]),t.on("click",function(){var a=e.checkboxGroup.indexOf(n.value);t[0].checked?-1===a&&e.checkboxGroup.push(n.value):-1!==a&&e.checkboxGroup.splice(a,1),e.$apply()}),e.$watchCollection("checkboxGroup",function(a){a&&-1!==e.checkboxGroup.indexOf(n.value)&&(t[0].checked=!0)})}}}function chosen(e,t){return{restrict:"A",scope:{chosen:"="},require:"?^ngModel",link:function(n,a,i,o){var r={no_results_text:"没有找到",display_selected_options:!1};i.width&&(r.width=i.width),require(["chosen"],function(){function l(e){var t=$("option:selected",a).not(":empty").clone().attr("selected",!0);
c&&c.abort(),c=$.ajax({url:i.selectSource,type:"post",data:{q:e},dataType:"json",success:function(n){if(200==n.code){for(var i="",r=n.data.length,l=angular.isArray(o.$viewValue)?o.$viewValue:[o.$viewValue],s=0;r>s;s++)-1==l.indexOf(n.data[s].value)&&(i+='<option value="'+n.data[s].value+'">'+n.data[s].text+"</option>");a.html(i).prepend(t),a.trigger("chosen:updated");var c=$.Event("keydown");c.which=39,d.val(e).trigger(c),n.data.length>0?u.find(".no-results").hide():u.find(".no-results").show()}},complete:function(){n.$digest()}})}function s(e){var a=$(this);if("paste"===e.type&&a.is(":not(:focus)")||e.keyCode&&(9===e.keyCode||13===e.keyCode||16===e.keyCode||17===e.keyCode||18===e.keyCode||19===e.keyCode||20===e.keyCode||27===e.keyCode||33===e.keyCode||34===e.keyCode||35===e.keyCode||36===e.keyCode||37===e.keyCode||38===e.keyCode||39===e.keyCode||40===e.keyCode||44===e.keyCode||45===e.keyCode||144===e.keyCode||145===e.keyCode||91===e.keyCode||93===e.keyCode||224===e.keyCode||e.keyCode>=112&&e.keyCode<=123))return!1;if(g&&32!=e.keyCode&&(e.keyCode<48||e.keyCode>57))return!1;u.find(".no-results").hide();var i=$.trim(a.val());return i||p!=i?(p=i,f=!0,n.searchTimer&&t.cancel(n.searchTimer),void(n.searchTimer=t(function(){f=!1,l(i)},600))):!1}if(i.selectSource)if(angular.isDefined(i.chosenAjax)){a.chosen(r);var c,u=a.next(),d=$("input",u),p="",g=!1,f=!1;$(".chosen-search > input, .chosen-choices .search-field input",u).on("keyup",s).on("paste",function(e){var t=this;setTimeout(function(){s.call(t,e)},500)}).on("keydown",function(e){g=229==e.keyCode})}else e(i.selectSource).then(function(e){for(var t=e[0],i="",l=t.length,s=angular.isArray(o.$viewValue)?o.$viewValue:[t[0].value],c=0;l>c;c++)i+='<option value="'+t[c].value+'"'+(s.indexOf(t[c].value)>-1?"selected":"")+">"+t[c].text+"</option>";a.html(i),a.chosen(n.chosen||r),o.$setViewValue(s)});else a.chosen(n.chosen||r)})}}}function formItem(e){return{restrict:"AE",scope:!0,replace:!0,link:function(t,n,a){var i=t.$eval(a.src),o="";switch(i.type){case"text":o='<input type="'+i.type+'" name="'+i.key+'" ng-init="formData[\''+i.key+"']='"+(i.value||"")+"'\" ng-model=\"formData['"+i.key+'\']" class="ipt" placeholder="'+i.placeholder+'" />';break;case"hidden":o='<input type="'+i.type+'" name="'+i.key+'" ng-init="formData[\''+i.key+"']='"+(i.value||"")+"'\" ng-model=\"formData['"+i.key+"']\"/>";break;case"date":o='<input type="'+i.type+'" name="'+i.key+'" ng-init="formData[\''+i.key+"']='"+(i.value||"")+"'\" ng-model=\"formData['"+i.key+'\']" class="ipt" placeholder="'+i.placeholder+'" convert-to-date/>';break;case"checkbox":o='<div class="form-ctrl" ng-init="formData[\''+i.key+"']=['"+(i.value||"")+"']\">",angular.forEach(i.options,function(e){o+='<label class="label"><input type="'+i.type+'" name="'+i.key+'" checkbox-group="formData[\''+i.key+'\']"  value="'+e+'" /> '+e+"</label>"}),o+="</div>";break;case"radio":o='<div class="form-ctrl" ng-init="formData[\''+i.key+"']='"+(i.value||"")+"'\">",angular.forEach(i.options,function(e){o+='<label class="label"><input type="'+i.type+'" name="'+i.key+'" ng-model="formData[\''+i.key+'\']"  value="'+e+'" /> '+e+"</label>"}),o+="</div>";break;case"select":o='<select class="select select-w" name="'+i.key+'" ng-init="formData[\''+i.key+"']='"+(i.value||"")+"'\" ng-model=\"formData['"+i.key+"']\"  >",o+='<option value="" >请选择</option>',angular.forEach(i.options,function(e){o+='<option value="'+e+'" >'+e+"</option>"}),o+="</select>";break;case"textarea":o='<textarea name="'+i.key+'" ng-init="formData[\''+i.key+"']='"+(i.value||"")+"'\" ng-model=\"formData['"+i.key+'\']"  class="textarea" placeholder="'+i.placeholder+'"></textarea>'}n.append(e(o)(t))}}}function customConfig(e){return{restrict:"AE",scope:!0,transclude:!0,require:"?^ngModel",link:function(t,n,a,i,o){e(function(){i&&(t.dataList=i.$viewValue||[])}),t.$watchCollection("dataList",function(e){e&&i&&i.$setViewValue(e)}),t.addRow=function(){t.dataList.push({})},t.delRow=function(e){t.dataList.splice(e,1)},o(t,function(e){n.append(e)})}}}ngView.$inject=["$route","$templateCache","$routeParams"],convertToDate.$inject=["$filter"],convertToNumber.$inject=[],detailsInfo.$inject=["requestData"],formValidator.$inject=["requestData","modal","dialogAlert"],tableList.$inject=["requestData","modal","dialogConfirm","$timeout"],filterConditions.$inject=["requestData"],treeList.$inject=["requestData","$timeout"],treeList2.$inject=["requestData","modal","$timeout","dialogConfirm"],navList.$inject=["requestData"],selectAsync.$inject=["requestData"],relativeSelect.$inject=["requestData","$timeout"],eChart.$inject=["requestData","dialogChart"],angucomplete.$inject=["$parse","requestData","$sce","$timeout"],chosen.$inject=["requestData","$timeout"],formItem.$inject=["$compile"],customConfig.$inject=["$timeout"],angular.module("manageApp.main").directive("ngView",ngView).directive("convertToDate",convertToDate).directive("convertToNumber",convertToNumber).directive("detailsInfo",detailsInfo).directive("formValidator",formValidator).directive("tableList",tableList).directive("tableCell",tableCell).directive("pagination",pagination).directive("pagination2",pagination2).directive("filterConditions",filterConditions).directive("treeList",treeList).directive("treeList2",treeList2).directive("navList",navList).directive("selectAsync",selectAsync).directive("relativeSelect",relativeSelect).directive("chart",eChart).directive("angucomplete",angucomplete).directive("checkboxGroup",checkboxGroup).directive("chosen",chosen).directive("formItem",formItem).directive("customConfig",customConfig)}),define("main/filters",["main/init"],function(){angular.module("manageApp.main")}),define("main/init",["angular"],function(){angular.module("manageApp.main",[])}),define("main/services",["main/init"],function(){function e(e,t){return{response:function(e){return"string"==typeof e.data&&/^<!DOCTYPE html>/.test(e.data)?(window.location.assign(e.config.url),e):e}}}function t(e,t,n){return function(a,i){var o=e.defer();return t({method:"POST",url:a,data:i||{},transformRequest:function(e){return n(e)},headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"}}).success(function(e,t,n,a){200==t&&200==e.code?o.resolve([e.data,e]):o.reject(e.message||"出错了")}).error(function(){o.reject("提交失败!")}),o.promise}}function n(e,t){return function(n,a){var i=e.$new(!1);i.confirmText=n||"确定删除?",t.openConfirm({template:"tpl/dialog-confirm.html",scope:i}).then(a)}}function a(e,t){return function(n,a){var i=e.$new(!1);i.confirmText=n||"确定",t.openConfirm({template:"tpl/dialog-alert.html",scope:i}).then(a)}}function i(e,t){return function(n,a){var i=e.$new(!1);i.content=n,t.openConfirm({template:"tpl/dialog-center.html",scope:i}).then(a)}}function o(e,t,n){return function(n){var a=e.$new(!1),i={},o=n.split("?");o[1]&&angular.forEach(o[1].split("&"),function(e){var t=e.split("=");i[t[0]]=t[1]}),a.url=n,a.urlParams=i,t.open({template:"tpl/dialog-center.html",scope:a})}}e.$inject=["$q","$location"],t.$inject=["$q","$http","$httpParamSerializer"],n.$inject=["$rootScope","modal"],a.$inject=["$rootScope","modal"],i.$inject=["$rootScope","modal"],o.$inject=["$rootScope","modal","$http"],angular.module("manageApp.main").factory("redirectInterceptor",e).service("requestData",t).service("dialogConfirm",n).service("dialogAlert",a).service("dialog",i).service("dialogChart",o).config(["$httpProvider",function(e){e.interceptors.push("redirectInterceptor")}])}),define("modal/directives",["modal/init"],function(){function e(e){return{restrict:"A",scope:{modalScope:"="},link:function(t,n,a){n.on("click",function(n){n.preventDefault();var i=angular.isDefined(t.modalScope)?t.modalScope:"noScope";angular.isDefined(a.ngDialogClosePrevious)&&e.close(a.ngDialogClosePrevious);var o=e.getDefaults();e.open({template:a.ngDialog,className:a.ngDialogClass||o.className,controller:a.ngDialogController,controllerAs:a.ngDialogControllerAs,bindToController:a.ngDialogBindToController,scope:i,data:a.ngDialogData,showClose:"false"===a.ngDialogShowClose?!1:"true"===a.ngDialogShowClose?!0:o.showClose,closeByDocument:"false"===a.ngDialogCloseByDocument?!1:"true"===a.ngDialogCloseByDocument?!0:o.closeByDocument,closeByEscape:"false"===a.ngDialogCloseByEscape?!1:"true"===a.ngDialogCloseByEscape?!0:o.closeByEscape,overlay:"false"===a.ngDialogOverlay?!1:"true"===a.ngDialogOverlay?!0:o.overlay,preCloseCallback:a.ngDialogPreCloseCallback||o.preCloseCallback})})}}}function t(e){return{restrict:"A",scope:{modalScope:"="},link:function(t,n,a){var i=a.modalRight||"50%";n.on("click",function(n){n.preventDefault(),e.closeAll(),e.open({template:a.modalUrl,className:"ngdialog-theme-right",cache:!1,trapFocus:!0,overlay:"true"==a.modalOverlay,data:a.modalData||t.modalScope.tr,scope:t.modalScope,controller:["$scope","$element",function(e,t){$(".ngdialog-content",t).width(i)}]})})}}}function n(e){return{restrict:"A",scope:{modalScope:"="},link:function(t,n,a){var i=a.modalCenter||"50%";n.on("click",function(n){n.preventDefault(),e.open({template:a.modalUrl,cache:!1,trapFocus:!1,data:a.modalData||t.modalScope.tr,scope:t.modalScope,controller:["$scope","$element",function(e,t){$(".ngdialog-content",t).width(i)}]})})}}}e.$inject=["modal"],t.$inject=["modal"],n.$inject=["modal"],angular.module("manageApp.modal").directive("modal",e).directive("modalRight",t).directive("modalCenter",n)}),define("modal/init",["angular"],function(){angular.module("manageApp.modal",[])}),define("modal/services",["modal/init"],function(){"use strict";var e=angular.module("manageApp.modal"),t=angular.element,n=angular.isDefined,a=(document.body||document.documentElement).style,i=n(a.animation)||n(a.WebkitAnimation)||n(a.MozAnimation)||n(a.MsAnimation)||n(a.OAnimation),o="animationend webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend",r="a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]",l="ngdialog-disabled-animation",s={html:!1,body:!1},c={},u=[],d=!1,p=!1;e.provider("modal",function(){var e=this.defaults={className:"ngdialog-theme-default",disableAnimation:!1,plain:!1,showClose:!0,closeByDocument:!0,closeByEscape:!0,closeByNavigation:!1,appendTo:!1,preCloseCallback:!1,overlay:!0,cache:!0,trapFocus:!0,preserveFocus:!0,ariaAuto:!0,ariaRole:null,ariaLabelledById:null,ariaLabelledBySelector:null,ariaDescribedById:null,ariaDescribedBySelector:null};this.setForceHtmlReload=function(e){s.html=e||!1},this.setForceBodyReload=function(e){s.body=e||!1},this.setDefaults=function(t){angular.extend(e,t)},this.setOpenOnePerName=function(e){p=e||!1};var n,a=0,g=0,f={};this.$get=["$document","$templateCache","$compile","$q","$http","$rootScope","$timeout","$window","$controller","$injector",function(m,h,v,y,b,$,D,k,w,C){var x=[],S={onDocumentKeydown:function(e){27===e.keyCode&&L.close("$escape")},activate:function(e){var t=e.data("$ngDialogOptions");t.trapFocus&&(e.on("keydown",S.onTrapFocusKeydown),x.body.on("keydown",S.onTrapFocusKeydown))},deactivate:function(e){e.off("keydown",S.onTrapFocusKeydown),x.body.off("keydown",S.onTrapFocusKeydown)},deactivateAll:function(e){angular.forEach(e,function(e){var t=angular.element(e);S.deactivate(t)})},setBodyPadding:function(e){var t=parseInt(x.body.css("padding-right")||0,10);x.body.css("padding-right",t+e+"px"),x.body.data("ng-dialog-original-padding",t),$.$broadcast("ngDialog.setPadding",e)},resetBodyPadding:function(){var e=x.body.data("ng-dialog-original-padding");e?x.body.css("padding-right",e+"px"):x.body.css("padding-right",""),$.$broadcast("ngDialog.setPadding",0)},performCloseDialog:function(e,t){var a=e.data("$ngDialogOptions"),r=e.attr("id"),l=c[r];if(l){if("undefined"!=typeof k.Hammer){var s=l.hammerTime;s.off("tap",n),s.destroy&&s.destroy(),delete l.hammerTime}else e.unbind("click");1===g&&x.body.unbind("keydown",S.onDocumentKeydown),e.hasClass("ngdialog-closing")||(g-=1);var p=e.data("$ngDialogPreviousFocus");p&&p.focus&&p.focus(),$.$broadcast("ngDialog.closing",e,t),g=0>g?0:g,i&&!a.disableAnimation?(l.$destroy(),e.unbind(o).bind(o,function(){S.closeDialogElement(e,t)}).addClass("ngdialog-closing")):(l.$destroy(),S.closeDialogElement(e,t)),f[r]&&(f[r].resolve({id:r,value:t,$dialog:e,remainingDialogs:g}),delete f[r]),c[r]&&delete c[r],u.splice(u.indexOf(r),1),u.length||(x.body.unbind("keydown",S.onDocumentKeydown),d=!1)}},closeDialogElement:function(e,t){e.remove(),0===g&&(x.html.removeClass("ngdialog-open"),x.body.removeClass("ngdialog-open"),S.resetBodyPadding()),$.$broadcast("ngDialog.closed",e,t)},closeDialog:function(e,t){var n=e.data("$ngDialogPreCloseCallback");if(n&&angular.isFunction(n)){var a=n.call(e,t);angular.isObject(a)?a.closePromise?a.closePromise.then(function(){S.performCloseDialog(e,t)}):a.then(function(){S.performCloseDialog(e,t)},function(){}):a!==!1&&S.performCloseDialog(e,t)}else S.performCloseDialog(e,t)},onTrapFocusKeydown:function(e){var t,n=angular.element(e.currentTarget);if(n.hasClass("ngdialog"))t=n;else if(t=S.getActiveDialog(),null===t)return;var a=9===e.keyCode,i=e.shiftKey===!0;a&&S.handleTab(t,e,i)},handleTab:function(e,t,n){var a=S.getFocusableElements(e);if(0===a.length)return void(document.activeElement&&document.activeElement.blur());var i=document.activeElement,o=Array.prototype.indexOf.call(a,i),r=-1===o,l=0===o,s=o===a.length-1,c=!1;n?(r||l)&&(a[a.length-1].focus(),c=!0):(r||s)&&(a[0].focus(),c=!0),c&&(t.preventDefault(),t.stopPropagation())},autoFocus:function(e){var n=e[0],a=n.querySelector("*[autofocus]");if(null===a||(a.focus(),document.activeElement!==a)){var i=S.getFocusableElements(e);if(i.length>0)return void i[0].focus();var o=S.filterVisibleElements(n.querySelectorAll("h1,h2,h3,h4,h5,h6,p,span"));if(o.length>0){var r=o[0];t(r).attr("tabindex","-1").css("outline","0"),r.focus()}}},getFocusableElements:function(e){var t=e[0],n=t.querySelectorAll(r),a=S.filterTabbableElements(n);return S.filterVisibleElements(a)},filterTabbableElements:function(e){for(var n=[],a=0;a<e.length;a++){var i=e[a];"-1"!==t(i).attr("tabindex")&&n.push(i)}return n},filterVisibleElements:function(e){for(var t=[],n=0;n<e.length;n++){var a=e[n];(a.offsetWidth>0||a.offsetHeight>0)&&t.push(a)}return t},getActiveDialog:function(){var e=document.querySelectorAll(".ngdialog");return 0===e.length?null:t(e[e.length-1])},applyAriaAttributes:function(e,t){if(t.ariaAuto){if(!t.ariaRole){var n=S.getFocusableElements(e).length>0?"dialog":"alertdialog";t.ariaRole=n}t.ariaLabelledBySelector||(t.ariaLabelledBySelector="h1,h2,h3,h4,h5,h6"),t.ariaDescribedBySelector||(t.ariaDescribedBySelector="article,section,p")}t.ariaRole&&e.attr("role",t.ariaRole),S.applyAriaAttribute(e,"aria-labelledby",t.ariaLabelledById,t.ariaLabelledBySelector),S.applyAriaAttribute(e,"aria-describedby",t.ariaDescribedById,t.ariaDescribedBySelector)},applyAriaAttribute:function(e,n,a,i){if(a&&e.attr(n,a),i){var o=e.attr("id"),r=e[0].querySelector(i);if(!r)return;var l=o+"-"+n;return t(r).attr("id",l),e.attr(n,l),l}},detectUIRouter:function(){try{return angular.module("ui.router"),!0}catch(e){return!1}},getRouterLocationEventName:function(){return S.detectUIRouter()?"$stateChangeSuccess":"$locationChangeSuccess"}},L={__PRIVATE__:S,open:function(i){function o(e,t){return $.$broadcast("ngDialog.templateLoading",e),b.get(e,t||{}).then(function(t){return $.$broadcast("ngDialog.templateLoaded",e),t.data||""})}function r(e){return e?angular.isString(e)&&m.plain?e:"boolean"!=typeof m.cache||m.cache?o(e,{cache:h}):o(e,{cache:!1}):"Empty template"}var s=null;if(i=i||{},!(p&&i.name&&(s=i.name+" dialog",this.isOpen(s)))){var m=angular.copy(e),A=++a;s=s||"ngdialog"+A,u.push(s),angular.extend(m,i);var P;f[s]=P=y.defer();var M;c[s]=M=angular.isObject(m.scope)?m.scope.$new():$.$new();var T,E,j=angular.extend({},m.resolve);return angular.forEach(j,function(e,t){j[t]=angular.isString(e)?C.get(e):C.invoke(e,null,null,t)}),y.all({template:r(m.template||m.templateUrl),locals:y.all(j)}).then(function(e){var a=e.template,i=e.locals;m.showClose&&(a+='<div class="ngdialog-close"></div>');var o=m.overlay?"":" ngdialog-no-overlay";if(T=t('<div id="'+s+'" class="ngdialog'+o+'"></div>'),T.html(m.overlay?'<div class="ngdialog-overlay"></div><div class="ngdialog-content" role="document">'+a+"</div>":'<div class="ngdialog-content" role="document">'+a+"</div>"),T.data("$ngDialogOptions",m),M.ngDialogId=s,m.data&&angular.isString(m.data)){var r=m.data.replace(/^\s*/,"")[0];M.ngDialogData="{"===r||"["===r?angular.fromJson(m.data):new String(m.data),M.dialogData=angular.copy(M.ngDialogData),M.ngDialogData.ngDialogId=s}else m.data&&angular.isObject(m.data)&&(M.ngDialogData=m.data,M.dialogData=angular.copy(M.ngDialogData),M.ngDialogData.ngDialogId=s);if(m.className&&T.addClass(m.className),m.disableAnimation&&T.addClass(l),E=m.appendTo&&angular.isString(m.appendTo)?angular.element(document.querySelector(m.appendTo)):x.body,S.applyAriaAttributes(T,m),m.preCloseCallback){var c;angular.isFunction(m.preCloseCallback)?c=m.preCloseCallback:angular.isString(m.preCloseCallback)&&M&&(angular.isFunction(M[m.preCloseCallback])?c=M[m.preCloseCallback]:M.$parent&&angular.isFunction(M.$parent[m.preCloseCallback])?c=M.$parent[m.preCloseCallback]:$&&angular.isFunction($[m.preCloseCallback])&&(c=$[m.preCloseCallback])),c&&T.data("$ngDialogPreCloseCallback",c)}if(M.closeThisDialog=function(e){S.closeDialog(T,e)},m.controller&&(angular.isString(m.controller)||angular.isArray(m.controller)||angular.isFunction(m.controller))){var u;m.controllerAs&&angular.isString(m.controllerAs)&&(u=m.controllerAs);var p=w(m.controller,angular.extend(i,{$scope:M,$element:T}),!0,u);m.bindToController&&angular.extend(p.instance,{ngDialogId:M.ngDialogId,ngDialogData:M.ngDialogData,closeThisDialog:M.closeThisDialog}),T.data("$ngDialogControllerController",p())}if(D(function(){var e=document.querySelectorAll(".ngdialog");S.deactivateAll(e),v(T)(M);var t=k.innerWidth-x.body.prop("clientWidth");x.html.addClass("ngdialog-open"),x.body.addClass("ngdialog-open");var n=t-(k.innerWidth-x.body.prop("clientWidth"));n>0&&S.setBodyPadding(n),E.append(T),S.activate(T),m.trapFocus&&S.autoFocus(T),m.name?$.$broadcast("ngDialog.opened",{dialog:T,name:m.name}):$.$broadcast("ngDialog.opened",T)}),d||(x.body.bind("keydown",S.onDocumentKeydown),d=!0),m.closeByNavigation){var f=S.getRouterLocationEventName();$.$on(f,function(){S.closeDialog(T)})}if(m.preserveFocus&&T.data("$ngDialogPreviousFocus",document.activeElement),n=function(e){var n=m.closeByDocument?t(e.target).hasClass("ngdialog-overlay"):!1,a=t(e.target).hasClass("ngdialog-close");(n||a)&&L.close(T.attr("id"),a?"$closeButton":"$document")},"undefined"!=typeof k.Hammer){var h=M.hammerTime=k.Hammer(T[0]);h.on("tap",n)}else T.bind("click",n);return g+=1,L}),{id:s,closePromise:P.promise,close:function(e){S.closeDialog(T,e)}}}},openConfirm:function(n){var a=y.defer(),i=angular.copy(e);n=n||{},angular.extend(i,n),i.scope=angular.isObject(i.scope)?i.scope.$new():$.$new(),i.scope.confirm=function(e){a.resolve(e);var n=t(document.getElementById(o.id));S.performCloseDialog(n,e)};var o=L.open(i);return o?(o.closePromise.then(function(e){return e?a.reject(e.value):a.reject()}),a.promise):void 0},isOpen:function(e){var n=t(document.getElementById(e));return n.length>0},close:function(e,n){var a=t(document.getElementById(e));if(a.length)S.closeDialog(a,n);else if("$escape"===e){var i=u[u.length-1];a=t(document.getElementById(i)),a.data("$ngDialogOptions").closeByEscape&&S.closeDialog(a,"$escape")}else L.closeAll(n);return L},closeAll:function(e){for(var n=document.querySelectorAll(".ngdialog"),a=n.length-1;a>=0;a--){var i=n[a];S.closeDialog(t(i),e)}},getOpenDialogs:function(){return u},getDefaults:function(){return e}};return angular.forEach(["html","body"],function(e){if(x[e]=m.find(e),s[e]){var t=S.getRouterLocationEventName();$.$on(t,function(){x[e]=m.find(e)})}}),L}]})}),define("project/controllers",["project/init"],function(){function e(e,t,n,a,i,o,r){function l(){e.$digest(),h=u.val(),v=d.val(),y=p.val(),e.canContinue=h&&v&&y}e.formData={},e.hasScore=!1,e.canContinue=!1,e.typeStudent=function(){n.find(".studentScoreIpt").focus()};var s=!0,c=!0,u=n.find(".selectBanji"),d=n.find(".selectKemu"),p=n.find(".selectDate"),g=u.attr("ng-model").split(".")[1],f=d.attr("ng-model").split(".")[1],m=p.attr("ng-model").split(".")[1],h=u.val(),v=d.val(),y=p.val();u.on("change",function(t){var a=$(this);if(e.hasScore&&e.canContinue){var u=a.val();a.val(h);var d=o.$new(!1);d.confirmText="你还没有保存当前录入记录,确定要保存?",d.confirmBtnTxt="保存",d.cancelBtnTxt="不保存",i.openConfirm({template:"tpl/dialog-confirm.html",scope:d}).then(function(){r(function(){s=!1,n.find(".saveBtn").trigger("click"),e.formData[g]=u,l()})})["catch"](function(t){"cancelBtn"==t&&r(function(){c=!1,n.find(".notSaveBtn").trigger("click"),e.formData[g]=u,l()})})}else r(l)}),d.on("change",function(t){var a=$(this);if(e.hasScore&&e.canContinue){var u=a.val();a.val(v);var d=o.$new(!1);d.confirmText="你还没有保存当前录入记录,确定要保存?",d.confirmBtnTxt="保存",d.cancelBtnTxt="不保存",i.openConfirm({template:"tpl/dialog-confirm.html",scope:d}).then(function(){r(function(){s=!1,n.find(".saveBtn").trigger("click"),e.formData[f]=u,l()})})["catch"](function(t){"cancelBtn"==t&&r(function(){c=!1,n.find(".notSaveBtn").trigger("click"),e.formData[f]=u,l()})})}else r(l)}),p.on("change",function(t){var a=$(this);if(e.hasScore&&e.canContinue){var u=a.val();a.val(y);var d=o.$new(!1);d.confirmText="你还没有保存当前录入记录,确定要保存?",d.confirmBtnTxt="保存",d.cancelBtnTxt="不保存",i.openConfirm({template:"tpl/dialog-confirm.html",scope:d}).then(function(){r(function(){s=!1,n.find(".saveBtn").trigger("click"),e.formData[m]=u,l()})})["catch"](function(t){"cancelBtn"==t&&r(function(){c=!1,n.find(".notSaveBtn").trigger("click"),e.formData[m]=u,l()})})}else r(l)}),e.typeScore=function(a,i,o){13==a.keyCode&&t(i,o).then(function(){e.formData.time=Date.now();var t=n.find(".studentNameIpt input");t.val("").focus(),n.find(".studentScoreIpt").val("")})["catch"](function(e){alert(e||"录入成绩错误")})},e.saveScore=function(n,o){s?a(n,function(){t(e.saveScoreUrl,e.formData).then(function(){e.hasScore=!1,e.formData.time=Date.now(),o?o():angular.isFunction(e.submitCallBack)&&e.submitCallBack.call(e),i.closeAll()})["catch"](function(e){alert(e||"保存错误")})}):t(e.saveScoreUrl,e.formData).then(function(){s=!0,e.hasScore=!1,e.formData.time=Date.now(),o?o():angular.isFunction(e.submitCallBack)&&e.submitCallBack.call(e)})["catch"](function(e){s=!0,alert(e||"保存错误")})},e.notSaveScore=function(n,o){c?a(n,function(){t(e.notSaveScoreUrl,e.formData).then(function(){e.hasScore=!1,e.formData.time=Date.now(),o?o():angular.isFunction(e.submitCallBack)&&e.submitCallBack.call(e),i.closeAll()})["catch"](function(e){})}):t(e.notSaveScoreUrl,e.formData).then(function(){c=!0,e.hasScore=!1,e.formData.time=Date.now(),o?o():angular.isFunction(e.submitCallBack)&&e.submitCallBack.call(e)})["catch"](function(e){c=!0})},e.listCallback=function(t){e.hasScore=t.hasScore};var b=$(".exitImportScore").on("click",function(t){if(e.hasScore&&e.canContinue){t.preventDefault(),t.stopPropagation();var n=o.$new(!1);n.confirmText="你还没有保存当前录入记录,确定要保存?",n.confirmBtnTxt="保存",n.cancelBtnTxt="不保存",i.openConfirm({template:"tpl/dialog-confirm.html",scope:n}).then(function(){r(function(){s=!1,e.saveScore("",function(){b.trigger("click")})})})["catch"](function(t){"cancelBtn"==t&&r(function(){c=!1,e.notSaveScore("",function(){b.trigger("click")})})})}})}function t(e,t,n){var a=t.find(".selectRecipient");n(function(){e.formData=angular.extend(e.$parent.formData,e.formData),e.formData.recipient=[],e.selectOne=function(t){var i=e.formData.recipient.indexOf(t.id);i>-1?e.formData.recipient.splice(i,1):e.formData.recipient.push(t.id),n(function(){a.trigger("chosen:updated")})},e.selectMultiple=function(t,i){var o=$(i.currentTarget),r=o.data("selected");angular.forEach(t,function(t){var n=e.formData.recipient.indexOf(t.id);r?n>-1&&e.formData.recipient.splice(n,1):-1==n&&e.formData.recipient.push(t.id)}),r?(o.data("selected",!1),o.text("全选")):(o.data("selected",!0),o.text("取消全选")),n(function(){a.trigger("chosen:updated")})}})}function n(e){e.submitCallBack=function(e,t){t?(alert("提交成功"),t.url?window.location.assign(t.url):window.location.reload()):alert("提交失败")}}e.$inject=["$scope","requestData","$element","dialogConfirm","modal","$rootScope","$timeout"],t.$inject=["$scope","$element","$timeout"],n.$inject=["$scope"],angular.module("manageApp.project").controller("importScoreCtrl",e).controller("noticePageCtrl",t).controller("noticeSubmitCtrl",n)}),define("project/directives",["moment","project/init"],function(e){function t(t){return{link:function(n,a,i){n.statusList={},n.dateSelect=function(e){window.location.assign(i.selectTo+e.format("YYYY-MM-DD"))},n.changeMonth=function(e){var a=e.format("YYYY-MM");t(i.tableCalendar,{month:a}).then(function(e){n.statusList=e[0]})},n.changeMonth(e())}}}function n(e){return{restrict:"AE",scope:{datePopover:"=?"},link:function(t,n){e(function(){t.datePopover&&(n.addClass(t.datePopover.css),n.on("mouseenter",function(){$(".popover").remove();var e=$('<div class="popover"><div class="arrow"></div><div class="popover-content"></div></div>');e.css({top:n.offset().top+5,left:n.offset().left});var a="<ul>";$.each(t.datePopover.eventList,function(e,t){3>e?a+="<li>"+t+"</li>":3==e&&(a+="<li>……</li>")}),a+="</ul>",$(".popover-content",e).html(a),e.appendTo("body")}),n.on("mouseleave",function(){$(".popover").remove()}),n.on("click",function(){$(".popover").remove()}))})}}}function a(){return{restrict:"AE",scope:{teacherList:"=",selectCount:"=?"},require:"?^ngModel",transclude:!0,link:function(e,t,n,a,i){e.$watch("teacherList",function(e){if(e){var t=0;angular.forEach(e,function(e,n){e.ruleIdList.length&&t++}),a.$setViewValue(t)}},!0),i(e,function(e){t.append(e)})}}}function i(e,t){return{restrict:"AE",scope:{requestUrl:"@",clickEdit:"=",status:"="},transclude:!0,template:'<div><span ng-show="!isEdit"><span ng-if="text===\'\'||text==undefined" class="color-red">未录入</span><span ng-if="text>=0">{{text}}</span></span><span ng-show="isEdit"><input type="text" class="ipt ipt-s ipt-xshort" ng-model="text" ng-keyup="finishInput($event)" ng-blur="cancelEdit()" /></span></div>',link:function(t,n,a){function i(){var e=t.$parent.$parent.details,n=0,a=0;angular.forEach(e.list,function(e){e.score>=0?a++:n++}),e.noScoreNum=n,e.hasScoreNum=a}t.text=t.clickEdit,n.on("click",function(e){t.status&&(t.isEdit=!0,t.$digest(),n.find("input").focus().select())});var o="";t.cancelEdit=function(){t.isEdit=!1;var n=t.text=$.trim(t.text);if(n){if(o==n)return;o=t.clickEdit=t.text=parseFloat(n)||0,e(t.requestUrl,{score:o}).then(function(e){t.$parent.$parent.$parent.hasScore=e[1].hasScore,i()})}},t.finishInput=function(e){13==e.keyCode&&(t.isEdit=!1)}}}}t.$inject=["requestData"],n.$inject=["$timeout"],i.$inject=["requestData","$timeout"],angular.module("manageApp.project").directive("tableCalendar",t).directive("datePopover",n).directive("scoreConfig",a).directive("clickEdit",i)}),define("project/filters",["project/init"],function(){angular.module("manageApp.project")}),define("project/init",["angular"],function(){angular.module("manageApp.project",[])}),define("project/services",["project/init"],function(){angular.module("manageApp.project")}),define("upload/directives",["upload/init"],function(){function e(){return{restrict:"EA",scope:{ngModel:"=",uploadMax:"@",uploadSize:"@",width:"@",height:"@"},replace:!0,templateUrl:"tpl/uploader.html",link:function(e,t,n){function a(){for(var t=r[0].files,n=0,a=t.length;a>n;n++){if(e.fileList.length>=e.uploadMax)return void alert("超过文件上传数");if(t[n].size/1024>e.uploadSize)return void alert("文件大小不能超过 "+e.uploadSize+" K");switch(l){case"*":var i={status:"uploading",file:t[n],progress:0,text:"上传中...",name:t[n].name,data:{}};e.fileList.push(i),e.$digest(),o(i);break;case"image":if(/image/g.test(t[n].type)){var i={status:"uploading",file:t[n],progress:0,text:"上传中...",name:t[n].name,data:{},imgSrc:window.URL.createObjectURL(new Blob([t[n]],{type:t[n].type}))};e.fileList.push(i),e.$digest(),o(i)}else alert("只能上传图片");break;default:if(new RegExp(l).test(t[n].type)){var i={status:"uploading",file:t[n],progress:0,text:"上传中...",data:{}};e.fileList.push(i),e.$digest(),o(i)}else alert("上传格式错误")}}}function i(t){var n=[],a=e.fileList.indexOf(t);a>-1&&e.fileList.splice(a,1),angular.forEach(e.fileList,function(e,t){n.push(e.data.id)}),e.ngModel=n}function o(t){var a=new XMLHttpRequest,i=new FormData;i.append("fileData",t.file),a.upload.addEventListener("progress",function(n){t.progress=Math.round(100*n.loaded/n.total),e.$digest()},!1),a.addEventListener("load",function(n){var a=angular.fromJson(n.target.responseText);t.progress=100,t.status="finished",t.text="上传成功！",t.data=a.data,e.ngModel.push(a.data.id),e.$apply()},!1),a.addEventListener("loadend",function(n){200!=n.target.status&&(t.status="error",t.text="上传失败！",e.$apply())}),a.open("POST",n.uploader),a.setRequestHeader("X-Requested-With","XMLHttpRequest"),a.send(i)}var r=$('<input type="file" multiple/>'),l=n.uploadType||"image",s=angular.fromJson(n.files||[]);e.fileList=[],e.delFile=i,e.ngModel=e.ngModel||[],e.uploadMax=e.uploadMax||99,e.uploadSize=e.uploadSize||1e3,e.width=e.width?e.width:"120px",e.height=e.height?e.height:"100px",angular.forEach(s,function(t){t.data=angular.copy(t),t.status="finished",/\.(jpe?g|png|gif)$/.test(t.url)&&(t.imgSrc=t.url),e.fileList.push(t),e.ngModel.push(t.id)}),e.$parent.resetPic=function(){e.ngModel=[],e.fileList=[]};var c=$(".uploadBtn",t);c.on("click",function(){r.trigger("click")}),r.on("change",a)}}}e.$inject=[],angular.module("manageApp.upload").directive("uploader",e)}),define("upload/init",["angular"],function(){angular.module("manageApp.upload",[])}),define("manageApp.template",["angular"],function(){!function(){"use strict";angular.module("manageApp.template",[]).run(["$templateCache",function(e){e.put("tpl/autocomplete.html",'<div class="angucomplete-holder"><input ng-model="searchStr" type="text" placeholder="{{placeholder}}" class="ipt" onmouseup="this.select();" ng-focus="resetHideResults()" ng-blur="hideResults()" ng-disabled="ngDisabled"><div class="angucomplete-dropdown" ng-if="showDropdown"><div class="angucomplete-searching" ng-show="searching">正在查询...</div><div class="angucomplete-searching" ng-show="!searching && (!results || results.length == 0)">没有结果</div><div class="angucomplete-row" ng-repeat="result in results" ng-mousedown="selectResult(result)" ng-mouseover="hoverRow()" ng-class="{\'angucomplete-selected-row\': $index == currentIndex}"><div class="angucomplete-title" ng-if="matchClass" ng-bind-html="result.title"></div><div class="angucomplete-title" ng-if="!matchClass">{{ result.title }}</div><div ng-if="result.description && result.description != \'\'" class="angucomplete-description">{{result.description}}</div></div></div></div>'),e.put("tpl/config-floor.html",'<table class="table-list"><tbody><tr><td>单元名称</td><td ng-repeat="unit in config.unitList track by $index"><input type="text" class="ipt ipt-s ipt-xshort" ng-model="config.unitList[$index]"></td></tr><tr><td>每层户数</td><td ng-repeat="col in config.unitColList track by $index"><input type="number" class="ipt ipt-s ipt-xshort" min="1" ng-model="config.unitColList[$index]"></td></tr></tbody></table>'),e.put("tpl/custom-config.html",'<table class="table-list"><thead><tr><th width="30"></th><th ng-repeat="th in theadList">{{th}}</th><th></th></tr></thead><tbody><tr class="r" ng-repeat="tr in dataList"><td>{{$trIndex = $index + 1}}</td><td ng-repeat="td in tr track by $index"><input type="text" name="{{inputName[$index]}}" class="ipt ipt-block" ng-model="tr[$index]"></td><td><button type="button" class="btn btn-s btn-orange" ng-click="delRow($index)"><i class="iconfont icon-delete"></i> 删除</button></td></tr></tbody><tfoot><tr><td></td><td colspan="{{theadList.length+1}}"><button type="button" class="btn btn-s btn-primary" ng-click="addRow()"><i class="iconfont icon-plus"></i> 新增</button></td></tr></tfoot></table>'),
e.put("tpl/datepicker.html",'<div ng-switch="view"><div ng-switch-when="date"><table><thead><tr><th ng-click="prev()">&lsaquo;</th><th colspan="5" class="switch" ng-click="setView(\'month\')" ng-bind="date|mFormat:\'YYYY MMMM\':tz"></th><th ng-click="next()">&rsaquo;</th></tr><tr><th ng-repeat="day in weekdays" style="overflow: hidden" ng-bind="day|mFormat:\'ddd\':tz"></th></tr></thead><tbody><tr ng-repeat="week in weeks" ng-init="$index2 = $index"><td ng-repeat="day in week"><span ng-class="classes[$index2][$index]" ng-click="selectDate(day)" ng-bind="day|mFormat:\'DD\':tz" date-popover="statusList[day.format(\'YYYYMMDD\')]"></span></td></tr></tbody></table></div><div ng-switch-when="year"><table><thead><tr><th ng-click="prev(10)">&lsaquo;</th><th colspan="5" class="switch" ng-bind="years[0].year()+\' - \'+years[years.length-1].year()"></th><th ng-click="next(10)">&rsaquo;</th></tr></thead><tbody><tr><td colspan="7"><span ng-class="classes[$index]" ng-repeat="year in years" ng-click="selectDate(year)" ng-bind="year.year()"></span></td></tr></tbody></table></div><div ng-switch-when="month"><table><thead><tr><th ng-click="prev()">&lsaquo;</th><th colspan="5" class="switch" ng-click="setView(\'year\')" ng-bind="date|mFormat:\'YYYY\':tz"></th><th ng-click="next()">&rsaquo;</th></tr></thead><tbody><tr><td colspan="7"><span ng-repeat="month in months" ng-class="classes[$index]" ng-click="selectDate(month)" ng-bind="month|mFormat:\'MMM\':tz"></span></td></tr></tbody></table></div><div ng-switch-when="hours"><table><thead><tr><th ng-click="prev(24)">&lsaquo;</th><th colspan="5" class="switch" ng-click="setView(\'date\')" ng-bind="date|mFormat:\'YYYY MMMM DD\':tz"></th><th ng-click="next(24)">&rsaquo;</th></tr></thead><tbody><tr><td colspan="7"><span ng-repeat="hour in hours" ng-class="classes[$index]" ng-click="selectDate(hour)" ng-bind="hour|mFormat:\'HH:mm\':tz"></span></td></tr></tbody></table></div><div ng-switch-when="minutes"><table><thead><tr><th ng-click="prev()">&lsaquo;</th><th colspan="5" class="switch" ng-click="setView(\'hours\')" ng-bind="date|mFormat:\'YYYY MMMM DD\':tz"></th><th ng-click="next()">&rsaquo;</th></tr></thead><tbody><tr><td colspan="7"><span ng-repeat="minute in minutes" ng-class="classes[$index]" ng-click="selectDate(minute)" ng-bind="minute|mFormat:\'HH:mm\':tz"></span></td></tr></tbody></table></div></div>'),e.put("tpl/dialog-alert.html",'<div class="page-dialog-wrap"><div class="page-dialog-content"><div class="mgb-l"><i class="iconfont icon-info text-xl vcenter color-gray"></i> {{confirmText}}</div><div class="text-center pd-v-s"><button type="button" class="btn btn-blue" ng-click="confirm()">确定</button></div></div></div>'),e.put("tpl/dialog-center.html",'<div class="page-dialog-wrap"><div class="page-dialog-content"><div class="mgb-l"><div ng-include="url"></div></div></div></div>'),e.put("tpl/dialog-confirm.html",'<div class="page-dialog-wrap"><div class="page-dialog-content"><div class="mgb-l">{{confirmText}}</div><div class="text-center pd-v-s"><button type="button" class="btn btn-gray" ng-click="closeThisDialog(\'cancelBtn\')">{{cancelBtnTxt||\'取消\'}}</button> <button type="button" class="btn btn-blue" ng-click="confirm()">{{confirmBtnTxt||\'确定\'}}</button></div></div></div>'),e.put("tpl/dialog-tree.html",'<div class="page-dialog-wrap"><div class="page-dialog-title">选择</div><div class="page-dialog-content"><div class="tree-list tree-list-border" tree-list="../data/tree.data" ng-model="selectItem"></div><div class="text-center pd-v-s"><button type="button" class="btn btn-gray" ng-click="closeThisDialog()">取消</button> <button type="button" class="btn btn-blue" ng-click="confirm(selectItem)">确定</button></div></div></div>'),e.put("tpl/pagination.html",'<ul class="pagination" ng-if="status.totalPage>1"><li ng-class="{disabled:status.currentPage==1}"><a ng-click="start()"><span class="iconfont icon-page-start"></span></a></li><li ng-class="{disabled:status.currentPage==1}"><a ng-click="prev()"><span class="iconfont icon-page-prev"></span></a></li><li ng-repeat="page in pages" ng-class="{active:page.active}"><a ng-click="goto(page.number)">{{page.text}}</a></li><li ng-class="{disabled:status.currentPage==status.totalPage}"><a ng-click="next()"><span class="iconfont icon-page-next"></span></a></li><li ng-class="{disabled:status.currentPage==status.totalPage}"><a ng-click="end()"><span class="iconfont icon-page-end"></span></a></li></ul>'),e.put("tpl/pagination2.html",'<ul class="pagination2" ng-if="status.totalPage!=1"><li class="text-muted">{{status.currentPage+"/" + status.totalPage}} 页</li><li><a ng-class="{\'on\':status.currentPage==1}" ng-click="start()"><i class="iconfont icon-page-start"></i></a></li><li><a ng-class="{\'on\':status.currentPage==1}" ng-click="prev()"><i class="iconfont icon-page-prev"></i></a></li><li><a ng-class="{\'on\':status.currentPage==status.totalPage}" ng-click="next()"><i class="iconfont icon-page-next"></i></a></li><li><a ng-class="{\'on\':status.currentPage==status.totalPage}" ng-click="end()"><i class="iconfont icon-page-end"></i></a></li></ul>'),e.put("tpl/table-cell.html",'<span ng-repeat="cell in cells" class="{{cell.css}}">{{cell.text}}</span>'),e.put("tpl/table-list.html",'<div><div class="fr"><pagination status="status"></pagination></div><div ng-transclude=""></div></div><table class="table-list"><thead><tr><th ng-if="listSelected"><input type="checkbox" class="selectAll"></th><th ng-repeat="(hKey,hValue) in theadList">{{hValue}}</th></tr></thead><tbody><tr ng-repeat="tr in tbodyList"><td ng-if="listSelected" class="select-td"><input type="checkbox" class="selectOne" value="{{tr.id}}">{{$index}}</td><td ng-repeat="(hKey,hValue) in theadList"><table-cell row="tr[hKey]"></table-cell></td></tr></tbody></table>'),e.put("tpl/tree.html",'<div class="loader" ng-if="status.isLoading"><div class="loader-inner pacman"><div></div><div></div><div></div><div></div><div></div></div></div><div ng-if="!status.isLoading"><div class="empty-wrap" ng-if="treeList.length==0"><div class="icon"><i class="iconfont icon-empty"></i></div><div>什么也没有</div></div><ul ng-if="treeList.length"><li ng-repeat="tree in treeList"><em ng-click="selectTree(tree,$event)"><i class="iconfont fold-p" ng-if="tree.nodes.length"></i> {{tree.name}}</em><ul ng-if="tree.nodes.length"><li ng-repeat="tree2 in tree.nodes"><em ng-click="selectTree(tree2,$event)"><i class="iconfont fold-p" ng-if="tree2.nodes.length"></i> {{tree2.name}}</em><ul ng-if="tree2.nodes.length"><li ng-repeat="tree3 in tree2.nodes"><em ng-click="selectTree(tree3,$event)"><i class="iconfont icon-house"></i> {{tree3.name}}</em></li></ul></li></ul></li></ul></div>'),e.put("tpl/uploader.html",'<div class="uploader-wrap"><div class="uploader-list"><div class="file" title="{{file.name}}" ng-style="{width:width,height:height}" ng-class="{finished:file.status==\'finished\',error:file.status==\'error\'}" ng-repeat="file in fileList">\' +<div class="img" ng-if="file.imgSrc" style="background-image: url({{file.imgSrc}})"></div><div class="img" ng-if="!file.imgSrc" style="background-size:50%;"></div><div class="progress-mask" style="height:{{file.progress}}%"></div><div class="del" ng-click="delFile(file)"><i class="iconfont icon-delete"></i></div><div class="text"><span class="status">{{file.text}}</span><i>{{file.progress}}%</i></div><div class="name">{{file.name}}</div></div><div class="file file-upload uploadBtn" ng-show="uploadMax>fileList.length" ng-style="{width:width,height:height}"><div class="flex-row flex-middle flex-center" style="height: 100%;"><div class="flex-item-12"><i class="iconfont icon-plus"></i></div></div></div></div></div>')}])}()}),!function(){var e=document.getElementsByTagName("script"),t=e[e.length-1];require.dir=t.src.match(/[^?#]*\//)[0]}(),require.config({baseUrl:require.dir+"modules",paths:{moment:"../libs/moment.min",echarts:"../libs/echarts.min",chosen:"../libs/chosen.jquery.min",jQuery:"../libs/jquery.min",angular:"../libs/angular.min"},shim:{jQuery:{exports:"jQuery"},chosen:{deps:["jQuery"]},echarts:{exports:"echarts"},angular:{deps:["jQuery"],exports:"angular"}},urlArgs:""}),define("manageApp.main",["main/init","main/services","main/controllers","main/directives","main/filters"]),define("manageApp.project",["project/init","project/services","project/controllers","project/directives","project/filters"]),define("manageApp.modal",["modal/init","modal/services","modal/directives"]),define("manageApp.upload",["upload/init","upload/directives"]),define("datePicker",["datepicker/datepicker"]),define("manageApp",["angular","manageApp.template","manageApp.modal","manageApp.main","manageApp.project","manageApp.upload","datePicker"],function(){return angular.module("manageApp",["ngRoute","manageApp.template","manageApp.modal","manageApp.main","manageApp.project","manageApp.upload","datePicker"])}),require(["manageApp"],function(e){e.config(["$routeProvider","$templateRequestProvider",function(e,t){window.Config?e.when("/:page*",{templateUrl:function(e){var t=(Config.viewsDir||"")+e.page;delete e.page;var n=$.param(e);return n?t+"?"+n:t},resolve:{load:function(){}}}).otherwise({redirectTo:Config.indexPage}):e.when("/:page*",{templateUrl:function(e){var t=e.page;delete e.page;var n=$.param(e);return n?t+"?"+n:t},resolve:{load:function(){}}}),t.httpOptions({headers:{template:"1"}})}]),angular.bootstrap(document,["manageApp"])});